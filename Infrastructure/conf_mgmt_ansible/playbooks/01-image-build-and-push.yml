---
# Playbook to create webserver
- hosts: localhost
  connection: local
  become: true
  tasks:
    - name: Run the equivalent of "apt-get update"
      apt:
        update_cache: yes

    - name: Provision Git, Java JRE, and .NetCore
      apt:
        name:
              - git
              - openjdk-19-jdk
    
    # - name: Provision other packages for .NetCore apps
    #   shell: |
    #     # apt-get update -y && apt-get install -yqq daemonize dbus-user-session fontconfig
    #     # daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target exec nsenter -t $(pidof systemd) -a su - $LOGNAME
    #     # apt install wget -y
    #     # wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
    #     # dpkg -i packages-microsoft-prod.deb
    #     apt update -y
    #     apt install apt-transport-https -y
    #     apt update -y
    #     apt install dotnet-sdk-6.0
    # - name: Provision the rest of packages properly for .NetCore apps
    #   apt:
    #     name:
    #           - dotnet-runtime-6.0
    #           - aspnetcore-runtime-6.0

    - name: Install VSCode
      shell: |
        apt install software-properties-common apt-transport-https wget --yes
        wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | apt-key add -
        add-apt-repository "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main" --yes
        apt install code --yes

    - name: Install Maven using Ansible
      apt:
        name: "{{ packages }}"
        state: present
      vars:
        packages:
           - maven


    - name: Install PostgreSQL
      shell: |
        sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
        wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -
        apt-get update -y
        apt-get -y install postgresql
    #Check its version with "psql --version"

    - name: Install Nginx
      apt:
        name: nginx
        state: latest
    # - name: Creating folder for files.
    #   file:
    #     path: /home/ubuntu/htmll/
    #     state: directory
    #     owner: root
    #     group: root
    #     mode: '0755'

    - name: Copy index.html template to Nginx configuration
      copy:
        src: ../../../Frontend/index.nginx-debian.html
        dest: /var/www/html/
        owner: root
        group: root
        mode: '0644'

    - name: Restarting service Nginx, in all cases
      ansible.builtin.service:
        name: nginx
        state: restarted

    # - name: Install Apache2
    #   shell: |
    #     apt-get install apache2 -y
    #     apt install snapd -y
    #     snap install dotnet-sdk


